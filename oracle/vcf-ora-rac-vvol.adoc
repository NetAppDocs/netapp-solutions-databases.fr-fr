---
sidebar: sidebar 
permalink: oracle/vcf-ora-rac-vvol.html 
keywords: Database, Oracle, AWS, FSx ONTAP, VMC, VMware 
summary: 'La solution fournit une vue d"ensemble et des détails sur le déploiement et la protection d"Oracle dans VMware Cloud Foundation (VCF) avec vSphere Virtual Volumes (vVols) comme stockage de base de données principal et base de données Oracle dans la configuration Real Application Clusters (RAC).' 
---
= TR-4997 : Déploiement et protection d'Oracle RAC dans VCF avec vVols
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


Allen Cao, Niyaz Mohamed, NetApp

[role="lead"]
La solution fournit une vue d'ensemble et des détails sur le déploiement et la protection d'Oracle dans VMware Cloud Foundation (VCF) avec vSphere Virtual Volumes (vVols) comme stockage de base de données principal et base de données Oracle dans la configuration Real Application Clusters (RAC).



== But

VMware vSphere Virtual Volumes (vVols) est une infrastructure de gestion et d'intégration SAN/NAS qui expose les disques virtuels en tant qu'objets de stockage natifs et permet des opérations basées sur des baies au niveau du disque virtuel.  En d'autres termes, vVols rend les périphériques SAN/NAS compatibles avec les machines virtuelles et permet d'exploiter les services de données basés sur des baies grâce à une approche centrée sur les machines virtuelles, à la granularité d'un seul disque virtuel. vVols permet aux clients d'exploiter les capacités uniques de leurs investissements de stockage actuels et de passer sans interruption à un modèle opérationnel plus simple et plus efficace, optimisé pour les environnements virtuels fonctionnant sur tous les types de stockage.

Danslink:vcf-ora-si-vvol.html["TR-4996"^] , nous avons démontré le déploiement et la protection d'une base de données Oracle à instance unique dans VCF avec vVols.  Cette documentation démontre le déploiement et la protection d'une base de données Oracle RAC dans un environnement VMware Cloud Foundation avec vVols comme stockage de base de données principal dans un cluster de stockage NetApp ONTAP .  La base de données Oracle RAC est configurée comme si elle était déployée dans des systèmes de fichiers locaux sur un système de stockage local.  Ce rapport technique se concentre sur les étapes de création de vVols dans VCF pour le déploiement d'Oracle RAC.  Nous démontrons également le déploiement de la base de données Oracle RAC dans VCF sur vVols avec la boîte à outils d'automatisation NetApp et la protection de la base de données RAC avec l'outil d'interface utilisateur NetApp SnapCenter .

Cette solution répond aux cas d’utilisation suivants :

* Déploiement de la base de données Oracle RAC dans VCF avec la banque de données vVols sur NetApp ONTAP AFF comme stockage de base de données principal
* Sauvegarde et restauration de bases de données Oracle dans VCF avec banque de données vVols à l'aide de l'outil d'interface utilisateur NetApp SnapCenter




== Public

Cette solution est destinée aux personnes suivantes :

* Un administrateur de base de données souhaitant déployer Oracle RAC dans VCF avec un datastore vVols sur NetApp ONTAP AFF comme stockage de base de données principal
* Un architecte de solutions de base de données qui souhaite tester les charges de travail Oracle RAC dans VCF avec une banque de données vVols sur un stockage NetApp ONTAP AFF
* Un administrateur de stockage souhaitant déployer et gérer une base de données Oracle RAC déployée sur VCF avec une banque de données vVols sur un stockage NetApp ONTAP AFF
* Un propriétaire d'application qui souhaite mettre en place une base de données Oracle RAC dans VCF avec un magasin de données vVol




== Environnement de test et de validation de solutions

Les tests et la validation de cette solution ont été effectués dans un environnement de laboratoire dans VCF avec un magasin de données vVols sur un stockage NetApp ONTAP AFF qui pourrait ne pas correspondre à l'environnement de déploiement final. Pour plus d'informations, consultez la section <<Facteurs clés à prendre en compte lors du déploiement>> .



=== Architecture

image:vcf-orarac-vvol-architecture.png["Cette image fournit une image détaillée de la configuration de déploiement Oracle dans le cloud public AWS avec iSCSI et ASM."]



=== Composants matériels et logiciels

[cols="33%, 33%, 33%"]
|===


3+| *Matériel* 


| NetApp ONTAP AFF A300 | Version 9.14.1P4 | Étagère DS224 avec 24 disques NVMe, capacité totale 35,2 Tio 


| Cluster VMware VSphere | Version 8.02 | 12 processeurs Intel® Xeon® Gold 5218 à 2,30 GHz, 8 nœuds (4 domaines de gestion et 4 domaines de charge de travail) 


3+| *Logiciel* 


| RedHat Linux | Noyau RHEL-8.6, 4.18.0-372.9.1.el8.x86_64 | Hébergement de serveurs Oracle DB, déploiement d'un abonnement RedHat pour les tests 


| Windows Server | Norme 2022, 10.0.20348 Build 20348 | Hébergement du serveur SnapCenter 


| Centos Linux | CentOS Linux version 8.5.2111 | Hébergement du contrôleur Ansible 


| Infrastructure Oracle Grid | Version 19.18 | Patch RU appliqué p34762026_190000_Linux-x86-64.zip 


| Base de données Oracle | Version 19.18 | Patch RU appliqué p34765931_190000_Linux-x86-64.zip 


| Oracle OPatch | Version 12.2.0.1.36 | Dernier correctif p6880880_190000_Linux-x86-64.zip 


| Serveur SnapCenter | Version 6.0 | Déploiement de groupe de travail 


| SnapCenter Plug-in for VMware vSphere | Version 6.0 | Déployé en tant que machine virtuelle ova sur un cluster vSphere 


| Outil ONTAP pour VMware vSphere | Version 9.13 | Déployé en tant que machine virtuelle ova sur un cluster vSphere 


| Ouvrir le JDK | Version java-11-openjdk-11.0.23.0.9-3.el8.x86_64 | Exigence du plug-in SnapCenter sur les machines virtuelles de base de données 
|===


=== Configuration de la base de données Oracle RAC dans VCF

[cols="33%, 33%, 33%"]
|===


3+|  


| *Nœud RAC* | *Base de données* | *Stockage de base de données* 


| ora01 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | Banques de données vVols (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) sur NetApp ONTAP AFF A300 


| ora02 | NTAP(NTAP_pdb1,NTAP_pdb2,NTAP_pdb3) | Banques de données vVols (VCF_ORA_BINS, VCF_ORA_CRS, VCF_ORA_DAT1, VCF_ORA_DAT2, VCF_ORA_LOGS) sur NetApp ONTAP AFF A300 
|===


=== Facteurs clés à prendre en compte lors du déploiement

* *Protocole pour la connectivité des vVols au cluster ONTAP .*  NFS ou iSCSI sont de bons choix.  Les niveaux de performance sont équivalents.  Dans cette démonstration de solution, nous avons utilisé iSCSI comme protocole de stockage pour la connectivité vVols au cluster de stockage ONTAP souligné.  Si l'infrastructure VCF prend en charge, les protocoles FC/FCoE et NVMe/FC sont également pris en charge pour les banques de données vVols sur NetApp ONTAP.
* *Disposition du stockage Oracle sur les banques de données vVols .*  Dans nos tests et validations, nous avons déployé cinq banques de données vVols pour les fichiers binaires Oracle, le registre/vote de cluster Oracle, les données Oracle et les fichiers journaux Oracle.  Il est recommandé de séparer les différents types de fichiers Oracle dans leurs propres banques de données afin que la sauvegarde, la récupération ou le clonage de la base de données puissent être facilement gérés et exécutés.  Créez des vVols dédiés pour les grandes bases de données et partagez des vVols pour les bases de données plus petites ou les bases de données avec un profil QoS similaire. 
* *Redondance du stockage Oracle.*  Utiliser `Normal Redundancy` pour les fichiers de registre/vote de cluster Oracle RAC critiques afin que trois fichiers de vote sur trois groupes de défaillance de disque ASM fournissent une protection de cluster optimale et que le registre de cluster soit mis en miroir parmi les groupes de défaillance de disque ASM.  Utiliser `External Redundancy` pour les fichiers binaires, de données et journaux Oracle afin d'optimiser l'utilisation du stockage.  Le ONTAP RAID-DP souligné assure la protection des données lorsque `External Redundancy` est employé.
* *Information d'identification pour l'authentification du stockage ONTAP .*  Utilisez uniquement les informations d'identification au niveau du cluster ONTAP pour l'authentification du cluster de stockage ONTAP , y compris la connectivité SnapCenter au cluster de stockage ONTAP ou la connectivité de l'outil ONTAP au cluster de stockage ONTAP .
* *Provisionnez le stockage de la banque de données vVols vers la machine virtuelle de base de données.*  Ajoutez un seul disque à la fois à la machine virtuelle de base de données à partir du magasin de données vVols .  L'ajout de plusieurs disques à partir de banques de données vVols en même temps n'est pas pris en charge pour le moment.  
* *Protection de la base de données.*  NetApp fournit une suite SnapCenter software pour la sauvegarde et la restauration de bases de données avec une interface utilisateur conviviale.  NetApp recommande de mettre en œuvre un tel outil de gestion pour obtenir une sauvegarde SnapShot rapide, une restauration et une récupération rapides de la base de données.




== Déploiement de la solution

Les sections suivantes fournissent des procédures étape par étape pour le déploiement de la base de données Oracle 19c dans VCF avec des banques de données vVols sur le stockage NetApp ONTAP dans une configuration Oracle RAC.



=== Prérequis pour le déploiement

[%collapsible%open]
====
Le déploiement nécessite les prérequis suivants.

. Un VMware VCF a été configuré.  Pour obtenir des informations ou des instructions sur la création d'un VCF, veuillez vous référer à la documentation VMwarelink:https://docs.vmware.com/en/VMware-Cloud-Foundation/index.html["Documentation de VMware Cloud Foundation"^] .
. Provisionnez trois machines virtuelles Linux, deux machines virtuelles pour le cluster de base de données Oracle RAC et une machine virtuelle pour le contrôleur Ansible dans le domaine de charge de travail VCF.  Provisionnez une machine virtuelle de serveur Windows pour exécuter le serveur NetApp SnapCenter .  Pour plus d'informations sur la configuration du contrôleur Ansible pour le déploiement automatisé de la base de données Oracle, reportez-vous aux ressources suivanteslink:https://docs.netapp.com/us-en/netapp-solutions-dataops/automation/getting-started.html["Premiers pas avec l'automatisation des solutions NetApp ^"^] .
. Les machines virtuelles de base de données Oracle RAC doivent avoir provisionné au moins deux interfaces réseau : une pour l'interconnexion privée Oracle RAC et une pour les applications ou le trafic de données publiques.
. La version 6.0 du plugin SnapCenter pour VMware vSphere a été déployée dans VCF.  Reportez-vous aux ressources suivantes pour le déploiement du plugin :link:https://docs.netapp.com/us-en/sc-plugin-vmware-vsphere/["Documentation du SnapCenter Plug-in for VMware vSphere"^] .
. L'outil ONTAP pour VMware vSphere a été déployé dans VCF.  Consultez les ressources suivantes pour l'outil ONTAP pour le déploiement de VMware vSphere :link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentation des ONTAP tools for VMware vSphere"^]



NOTE: Assurez-vous d'avoir alloué au moins 50 Go au volume racine d'Oracle VM afin de disposer de suffisamment d'espace pour préparer les fichiers d'installation d'Oracle.

====


=== Créer un profil de capacité de stockage

[%collapsible%open]
====
Tout d’abord, créez un profil de capacité de stockage personnalisé pour le stockage ONTAP souligné qui héberge la banque de données vVols .

. À partir des raccourcis du client vSphere, ouvrez l’outil NetApp ONTAP .  Assurez-vous que le cluster de stockage ONTAP a été ajouté à `Storage Systems` dans le cadre du déploiement de l'outil ONTAP .
+
image:vcf-ora-vvol-scp-001.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."] image:vcf-ora-vvol-scp-008.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]

. Cliquez sur `Storage capability profile` pour ajouter un profil personnalisé pour Oracle.  Nommez le profil et ajoutez une brève description.
+
image:vcf-ora-vvol-scp-002.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]

. Choisissez la catégorie de contrôleur de stockage : performances, capacité ou hybride.
+
image:vcf-ora-vvol-scp-003.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]

. Sélectionnez le protocole.
+
image:vcf-ora-vvol-scp-004.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]

. Définissez une politique QoS si vous le souhaitez.
+
image:vcf-ora-vvol-scp-005.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]

. Attributs de stockage supplémentaires pour le profil.  Assurez-vous que le cryptage est activé sur le contrôleur NetApp si vous souhaitez disposer de la capacité de cryptage, sinon cela peut entraîner des problèmes lors de l'application du profil.
+
image:vcf-ora-vvol-scp-006.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]

. Consultez le résumé et terminez la création du profil de capacité de stockage.
+
image:vcf-ora-vvol-scp-007.png["Capture d'écran montrant une configuration de profil de capacité de stockage personnalisé."]



====


=== Créer et configurer la banque de données vVols

[%collapsible%open]
====
Une fois les conditions préalables remplies, connectez-vous au VCF en tant qu'utilisateur administrateur via le client vSphere, en accédant au domaine de charge de travail.  N'utilisez pas l'option de stockage VMware intégrée pour créer des vVols.  Utilisez plutôt l’outil NetApp ONTAP pour créer des vVols.  Ce qui suit illustre les procédures de création et de configuration de vVols.

. Le flux de travail de création de vVols peut être déclenché soit à partir de l'interface de l'outil ONTAP , soit à partir du cluster de domaine de charge de travail VCF.
+
image:vcf-ora-vvol-datastore-001.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

+
image:vcf-ora-vvol-datastore-001-b.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Remplissage des informations générales pour le magasin de données, y compris la destination de provisionnement, le type, le nom et le protocole.
+
image:vcf-orarac-vvol-datastore-001.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Sélectionnez le profil de capacité de stockage personnalisé créé à l'étape précédente, le `Storage system` , et `Storage VM` , où les vVols doivent être créés.
+
image:vcf-orarac-vvol-datastore-002.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Choisir `Create new volumes` , remplissez le nom et la taille du volume et cliquez sur `ADD` alors `NEXT` pour passer à la page de résumé.
+
image:vcf-orarac-vvol-datastore-003.png["Capture d'écran montrant la configuration de la banque de données vVols ."] image:vcf-orarac-vvol-datastore-004.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Cliquez `Finish` pour créer une banque de données vVols pour le binaire Oracle.
+
image:vcf-orarac-vvol-datastore-005.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Créez une banque de données pour le registre de cluster Oracle ou CRS.
+
image:vcf-orarac-vvol-datastore-006.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

+

NOTE: Vous pouvez ajouter plusieurs volumes à une banque de données vVols ou répartir les volumes d'une banque de données vVols sur plusieurs nœuds de contrôleur ONTAP pour des raisons de performances ou de redondance.

. Créer une banque de données pour les données Oracle.  Idéalement, créez des banques de données distinctes sur chaque nœud de contrôleur ONTAP et utilisez Oracle ASM pour répartir les données sur les nœuds de contrôleur afin de maximiser l'utilisation de la capacité du cluster de stockage ONTAP .
+
image:vcf-orarac-vvol-datastore-006-a.png["Capture d'écran montrant la configuration de la banque de données vVols ."] image:vcf-orarac-vvol-datastore-006-b.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Créer une banque de données pour le journal Oracle.  Étant donné la nature séquentielle de l’écriture du journal Oracle, il est judicieux de le placer sur un seul nœud de contrôleur ONTAP .
+
image:vcf-orarac-vvol-datastore-006-c.png["Capture d'écran montrant la configuration de la banque de données vVols ."]

. Validez les banques de données Oracle après le déploiement.
+
image:vcf-orarac-vvol-datastore-007.png["Capture d'écran montrant la configuration de la banque de données vVols ."]



====


=== Créer une politique de stockage de machine virtuelle basée sur le profil de capacité de stockage

[%collapsible%open]
====
Avant de provisionner le stockage de la banque de données vVols vers la machine virtuelle de base de données, ajoutez une stratégie de stockage de machine virtuelle basée sur le profil de capacité de stockage créé à l'étape précédente.  Voici les procédures à suivre.

. À partir des menus du client vSphere, ouvrez `Policies and Profiles` et mettre en évidence `VM Storage Policies` .  Cliquez `Create` ouvrir `VM Storage Policies` flux de travail.
+
image:vcf-ora-vvol-vm-policy-001.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. Nommez la politique de stockage de la machine virtuelle.
+
image:vcf-ora-vvol-vm-policy-002.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. Dans `Datastore specific rules` , vérifier `Enable rules for "NetAPP.clustered.Data.ONTAP.VP.vvol" storage`
+
image:vcf-ora-vvol-vm-policy-003.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. Pour les règles NetApp.clustered.Data.ONTAP ONTAP `Placement` , sélectionnez le profil de capacité de stockage personnalisé créé à l'étape précédente.
+
image:vcf-ora-vvol-vm-policy-004.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. Pour les règles NetApp.clustered.Data.ONTAP ONTAP `Replication` , choisir `Disabled` si les vVols ne sont pas répliqués.
+
image:vcf-ora-vvol-vm-policy-004-a.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. La page de compatibilité de stockage affiche les banques de données vVols compatibles dans l'environnement VCF.
+
image:vcf-orarac-vvol-datastore-008.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. Révisez et terminez la création de la politique de stockage de la machine virtuelle.
+
image:vcf-ora-vvol-vm-policy-006.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]

. Validez la politique de stockage de la machine virtuelle qui vient d’être créée.
+
image:vcf-ora-vvol-vm-policy-007.png["Capture d’écran montrant une configuration de politique de stockage de machine virtuelle."]



====


=== Allouer des disques aux machines virtuelles RAC à partir des banques de données vVols et configurer le stockage de la base de données

[%collapsible%open]
====
À partir du client vSphere, ajoutez les disques souhaités des banques de données vVols à la machine virtuelle de base de données en modifiant les paramètres de la machine virtuelle.  Ensuite, connectez-vous à la machine virtuelle pour formater et monter le disque binaire sur les points de montage /u01.  Ce qui suit montre les étapes et les tâches exactes.

. Avant d'allouer des disques de la banque de données à la machine virtuelle de base de données, connectez-vous aux hôtes VMware ESXi pour valider et garantir que les enregistreurs multiples sont activés (valeur GBLAllowMW définie sur 1) au niveau ESXi.
+
....
[root@vcf-wkld-esx01:~] which esxcli
/bin/esxcli
[root@vcf-wkld-esx01:~] esxcli system settings advanced list -o /VMFS3/GBLAllowMW
   Path: /VMFS3/GBLAllowMW
   Type: integer
   Int Value: 1
   Default Int Value: 1
   Min Value: 0
   Max Value: 1
   String Value:
   Default String Value:
   Valid Characters:
   Description: Allow multi-writer GBLs.
   Host Specific: false
   Impact: none
[root@vcf-wkld-esx01:~]

....
. Ajoutez un nouveau contrôleur SCSI dédié à utiliser avec les disques Oracle RAC.  Désactiver le partage de bus SCSI.
+
image:vcf-orarac-vvol-vm-001.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1 - ora01, ajoutez un disque à la machine virtuelle pour le stockage binaire Oracle sans partage.
+
image:vcf-orarac-vvol-vm-002.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1, ajoutez trois disques à la machine virtuelle pour le stockage Oracle RAC CRS et activez le partage multi-enregistreur.
+
image:vcf-orarac-vvol-vm-003.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-004.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-005.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1, ajoutez deux disques de chaque banque de données pour les données vers la machine virtuelle pour le stockage de données Oracle partagé.
+
image:vcf-orarac-vvol-vm-006.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-008.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-009.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-010.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 1, ajoutez deux disques à la machine virtuelle à partir du magasin de données de journaux pour le stockage des fichiers journaux Oracle partagés.
+
image:vcf-orarac-vvol-vm-011.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-012.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 2, ajoutez un disque à la machine virtuelle pour le stockage binaire Oracle sans partage.
+
image:vcf-orarac-vvol-vm-013.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. À partir du nœud RAC 2, ajoutez d’autres disques partagés en sélectionnant `Existing Hard Disks` option et activer le partage multi-enregistreur pour chaque disque partagé.
+
image:vcf-orarac-vvol-vm-014.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."] image:vcf-orarac-vvol-vm-015.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. De VM `Edit Settings` , `Advanced Parameters` , ajouter un attribut `disk.enableuuid` avec valeur `TRUE` .  La machine virtuelle doit être arrêtée pour ajouter le paramètre avancé.  La définition de cette option permet à SnapCenter d’identifier précisément le vVol dans votre environnement.  Cela doit être fait sur tous les nœuds RAC.
+
image:vcf-ora-vvol-vm-uuid.png["Capture d'écran montrant une configuration de stockage de machine virtuelle."]

. Maintenant, redémarrez la VM.  Connectez-vous à la machine virtuelle en tant qu'utilisateur administrateur via ssh pour examiner les lecteurs de disque nouvellement ajoutés.
+
....
[admin@ora01 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora01 ~]$

[admin@ora02 ~]$ sudo lsblk
NAME          MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda             8:0    0   50G  0 disk
├─sda1          8:1    0  600M  0 part /boot/efi
├─sda2          8:2    0    1G  0 part /boot
└─sda3          8:3    0 48.4G  0 part
  ├─rhel-root 253:0    0 43.4G  0 lvm  /
  └─rhel-swap 253:1    0    5G  0 lvm  [SWAP]
sdb             8:16   0   50G  0 disk
sdc             8:32   0   10G  0 disk
sdd             8:48   0   10G  0 disk
sde             8:64   0   10G  0 disk
sdf             8:80   0   40G  0 disk
sdg             8:96   0   40G  0 disk
sdh             8:112  0   40G  0 disk
sdi             8:128  0   40G  0 disk
sdj             8:144  0   80G  0 disk
sdk             8:160  0   80G  0 disk
sr0            11:0    1 1024M  0 rom
[admin@ora02 ~]$


....
. À partir de chaque nœud RAC, partitionnez le disque binaire Oracle (/dev/sdb) en tant que partition principale et unique en acceptant simplement les choix par défaut.
+
[source, cli]
----
sudo fdisk /dev/sdb
----
. Formatez les disques partitionnés en tant que systèmes de fichiers xfs.
+
[source, cli]
----
sudo mkfs.xfs /dev/sdb1
----
. Montez le disque sur le point de montage /u01.
+
....
[admin@ora01 ~]$ df -h
Filesystem             Size  Used Avail Use% Mounted on
devtmpfs               7.7G   36K  7.7G   1% /dev
tmpfs                  7.8G  1.4G  6.4G  18% /dev/shm
tmpfs                  7.8G   34M  7.7G   1% /run
tmpfs                  7.8G     0  7.8G   0% /sys/fs/cgroup
/dev/mapper/rhel-root   44G   29G   16G  66% /
/dev/sda2             1014M  249M  766M  25% /boot
/dev/sda1              599M  5.9M  593M   1% /boot/efi
/dev/sdb1               50G   24G   27G  47% /u01
tmpfs                  1.6G   12K  1.6G   1% /run/user/42
tmpfs                  1.6G     0  1.6G   0% /run/user/54331
tmpfs                  1.6G  4.0K  1.6G   1% /run/user/1000


....
. Ajoutez des points de montage à /etc/fstab afin que les lecteurs de disque soient montés au redémarrage de la machine virtuelle.
+
[source, cli]
----
sudo vi /etc/fstab
----
+
....
[oracle@ora_01 ~]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Oct 18 19:43:31 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=aff942c4-b224-4b62-807d-6a5c22f7b623 /boot                   xfs     defaults        0 0
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
/root/swapfile swap swap defaults 0 0
/dev/sdb1               /u01                    xfs     defaults        0 0
....


====


=== Déploiement d'Oracle RAC dans VCF

[%collapsible%open]
====
Il est recommandé d'utiliser la boîte à outils d'automatisation NetApp pour déployer Oracle RAC dans VCF avec vVols.  Lisez attentivement les instructions incluses (READme) et configurez les fichiers de paramètres de déploiement tels que le fichier cible de déploiement - hôtes, le fichier de variables globales - vars/vars.yml et le fichier de variables de machine virtuelle de base de données locale - host_vars/host_name.yml en suivant les instructions de la boîte à outils.  Voici les procédures étape par étape.

. Connectez-vous à la machine virtuelle du contrôleur Ansible en tant qu'utilisateur administrateur via ssh et clonez une copie de la boîte à outils d'automatisation pour le déploiement d'Oracle RAC dans VCF avec vVols.
+
[source, cli]
----
git clone https://bitbucket.ngage.netapp.com/scm/ns-bb/na_oracle_deploy_rac.git
----
. Placez les fichiers d'installation Oracle suivants dans le dossier /tmp/archive sur la machine virtuelle de base de données du nœud RAC 1.  Le dossier doit autoriser l'accès à tous les utilisateurs disposant de l'autorisation 777.
+
....
LINUX.X64_193000_grid_home.zip
p34762026_190000_Linux-x86-64.zip
LINUX.X64_193000_db_home.zip
p34765931_190000_Linux-x86-64.zip
p6880880_190000_Linux-x86-64.zip
....
. Configurez l'authentification sans clé SSH entre le contrôleur Ansible et les machines virtuelles de base de données, ce qui nécessite de générer une paire de clés SSH et de copier la clé publique dans le répertoire racine de l'utilisateur administrateur des machines virtuelles de base de données, le dossier .ssh et le fichier authorized_keys.
+
[source, cli]
----
ssh-keygen
----
. Configurez les fichiers de paramètres d'hôte cible définis par l'utilisateur.  Voici un exemple de configuration typique pour le fichier d'hôtes cible - hosts.
+
....
#Oracle hosts
[oracle]
ora01 ansible_host=10.61.180.21 ansible_ssh_private_key_file=ora01.pem
ora02 ansible_host=10.61.180.22 ansible_ssh_private_key_file=ora02.pem

....
. Configurez les fichiers de paramètres spécifiques à l'hôte local définis par l'utilisateur.  Voici un exemple de configuration typique pour le fichier host_name.yml local - ora01.yml.
+
....

# Binary lun
ora_bin: /dev/sdb

# Host DB configuration
ins_sid: "{{ oracle_sid }}1"
asm_sid: +ASM1

....
. Configurez le fichier de paramètres globaux définis par l'utilisateur.  Voici un exemple de configuration typique pour le fichier de paramètres globaux - vars.yml
+
....

#######################################################################
### ONTAP env specific config variables                             ###
#######################################################################

# ONTAP storage platform: on-prem, vmware-vvols
ontap_platform: vmware-vvols

# Prerequisite to create five vVolss in VMware vCenter
# VCF_ORA_BINS - Oracle binary
# VCF_ORA_CRS  - Oracle cluster registry and vote
# VCF_ORA_DAT1 - Oracle data on node1
# VCF_ORA_DAT2 - Oracle data on node2
# VCF_ORA_LOGS - Oracle logs on node1 or node2

# Oracle disks are added to VM from vVols: 1 binary disk, 3 CRS disks, 4 data disks, and 2 log disks.


######################################################################
### Linux env specific config variables                            ###
######################################################################

redhat_sub_username: XXXXXXXX
redhat_sub_password: "XXXXXXXX"

# Networking configuration
cluster_pub_ip:
  - {ip: 10.61.180.21, hostname: ora01}
  - {ip: 10.61.180.22, hostname: ora02}

cluster_pri_ip:
  - {ip: 172.21.166.22, hostname: ora01-pri}
  - {ip: 172.21.166.24, hostname: ora02-pri}

cluster_vip_ip:
  - {ip: 10.61.180.93, hostname: ora01-vip}
  - {ip: 10.61.180.94, hostname: ora02-vip}

cluster_scan_name: ntap-scan
cluster_scan_ip:
  - {ip: 10.61.180.90, hostname: ntap-scan}
  - {ip: 10.61.180.91, hostname: ntap-scan}
  - {ip: 10.61.180.92, hostname: ntap-scan}


#####################################################################
### DB env specific install and config variables                  ###
#####################################################################

# Shared Oracle RAC storage
ora_crs:
  - { device: /dev/sdc, name: ora_crs_01 }
  - { device: /dev/sdd, name: ora_crs_02 }
  - { device: /dev/sde, name: ora_crs_03 }

ora_data:
  - { device: /dev/sdf, name: ora_data_01 }
  - { device: /dev/sdg, name: ora_data_02 }
  - { device: /dev/sdh, name: ora_data_03 }
  - { device: /dev/sdi, name: ora_data_04 }

ora_logs:
  - { device: /dev/sdj, name: ora_logs_01 }
  - { device: /dev/sdk, name: ora_logs_02 }

# Oracle RAC configuration

oracle_sid: NTAP
cluster_name: ntap-rac
cluster_nodes: ora01,ora02
cluster_domain: solutions.netapp.com
grid_cluster_nodes: ora01:ora01-vip:HUB,ora02:ora02-vip:HUB
network_interface_list: ens33:10.61.180.0:1,ens34:172.21.166.0:5
memory_limit: 10240

# Set initial password for all required Oracle passwords. Change them after installation.
initial_pwd_all: "XXXXXXXX"

....
. À partir du contrôleur Ansible, du répertoire de base de la boîte à outils d'automatisation clonée /home/admin/na_oracle_deploy_rac, exécutez le playbook des prérequis pour configurer les prérequis d'Ansible.
+
[source, cli]
----
ansible-playbook -i hosts 1-ansible_requirements.yml
----
. Exécutez le playbook de configuration Linux.
+
[source, cli]
----
ansible-playbook -i hosts 2-linux_config.yml -u admin -e @vars/vars.yml
----
. Exécutez le playbook de déploiement Oracle.
+
[source, cli]
----
ansible-playbook -i hosts 4-oracle_config.yml -u admin -e @vars/vars.yml
----
. En option, tous les playbooks ci-dessus peuvent également être exécutés à partir d'une seule exécution de playbook.
+
[source, cli]
----
ansible-playbook -i hosts 0-all_playbook.yml -u admin -e @vars/vars.yml
----


====


=== Validation du déploiement d'Oracle RAC dans VCF

[%collapsible%open]
====
Cette section fournit des détails sur la validation du déploiement d'Oracle RAC dans VCF pour garantir que toutes les ressources Oracle RAC sont entièrement déployées, configurées et fonctionnent comme prévu.

. Connectez-vous à la machine virtuelle RAC en tant qu'utilisateur administrateur pour valider l'infrastructure de grille Oracle.
+
....
[admin@ora01 ~]$ sudo su
[root@ora01 admin]# su - grid
[grid@ora01 ~]$ crsctl stat res -t
--------------------------------------------------------------------------------
Name           Target  State        Server                   State details
--------------------------------------------------------------------------------
Local Resources
--------------------------------------------------------------------------------
ora.LISTENER.lsnr
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.chad
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.net1.network
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.ons
               ONLINE  ONLINE       ora01                    STABLE
               ONLINE  ONLINE       ora02                    STABLE
ora.proxy_advm
               OFFLINE OFFLINE      ora01                    STABLE
               OFFLINE OFFLINE      ora02                    STABLE
--------------------------------------------------------------------------------
Cluster Resources
--------------------------------------------------------------------------------
ora.ASMNET1LSNR_ASM.lsnr(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.DATA.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN1.lsnr
      1        ONLINE  ONLINE       ora01                    STABLE
ora.LISTENER_SCAN2.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.LISTENER_SCAN3.lsnr
      1        ONLINE  ONLINE       ora02                    STABLE
ora.RECO.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.VOTE.dg(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.asm(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    Started,STABLE
      2        ONLINE  ONLINE       ora02                    Started,STABLE
ora.asmnet1.asmnetwork(ora.asmgroup)
      1        ONLINE  ONLINE       ora01                    STABLE
      2        ONLINE  ONLINE       ora02                    STABLE
ora.cvu
      1        ONLINE  ONLINE       ora02                    STABLE
ora.ntap.db
      1        ONLINE  ONLINE       ora01                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
      2        ONLINE  ONLINE       ora02                    Open,HOME=/u01/app/o
                                                             racle2/product/19.0.
                                                             0/NTAP,STABLE
ora.ora01.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.ora02.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.qosmserver
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan1.vip
      1        ONLINE  ONLINE       ora01                    STABLE
ora.scan2.vip
      1        ONLINE  ONLINE       ora02                    STABLE
ora.scan3.vip
      1        ONLINE  ONLINE       ora02                    STABLE
--------------------------------------------------------------------------------
[grid@ora01 ~]$

....
. Valider Oracle ASM.
+
....
[grid@ora01 ~]$ asmcmd
ASMCMD> lsdg
State    Type    Rebal  Sector  Logical_Sector  Block       AU  Total_MB  Free_MB  Req_mir_free_MB  Usable_file_MB  Offline_disks  Voting_files  Name
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163723                0          163723              0             N  DATA/
MOUNTED  EXTERN  N         512             512   4096  1048576    163840   163729                0          163729              0             N  RECO/
MOUNTED  NORMAL  N         512             512   4096  4194304     30720    29732            10240            9746              0             Y  VOTE/
ASMCMD> lsdsk
Path
AFD:ORA_CRS_01
AFD:ORA_CRS_02
AFD:ORA_CRS_03
AFD:ORA_DATA_01
AFD:ORA_DATA_02
AFD:ORA_DATA_03
AFD:ORA_DATA_04
AFD:ORA_LOGS_01
AFD:ORA_LOGS_02
ASMCMD> afd_state
ASMCMD-9526: The AFD state is 'LOADED' and filtering is 'ENABLED' on host 'ora01'
ASMCMD>

....
. Répertorier les nœuds du cluster.
+
....

[grid@ora01 ~]$ olsnodes
ora01
ora02

....
. Valider OCR/VOTE.
+
....
[grid@ora01 ~]$ ocrcheck
Status of Oracle Cluster Registry is as follows :
         Version                  :          4
         Total space (kbytes)     :     901284
         Used space (kbytes)      :      84536
         Available space (kbytes) :     816748
         ID                       :  118267044
         Device/File Name         :      +VOTE
                                    Device/File integrity check succeeded

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

                                    Device/File not configured

         Cluster registry integrity check succeeded

         Logical corruption check bypassed due to non-privileged user

[grid@ora01 ~]$ crsctl query css votedisk
##  STATE    File Universal Id                File Name Disk group
--  -----    -----------------                --------- ---------
 1. ONLINE   1ca3fcb0bd354f8ebf00ac97d70e0824 (AFD:ORA_CRS_01) [VOTE]
 2. ONLINE   708f84d505a54f58bf41124e09a5115a (AFD:ORA_CRS_02) [VOTE]
 3. ONLINE   133ecfcedb684fe6bfdc1899b90f91c7 (AFD:ORA_CRS_03) [VOTE]
Located 3 voting disk(s).
[grid@ora01 ~]$


....
. Valider l'écouteur Oracle.
+
....
[grid@ora01 ~]$ lsnrctl status listener

LSNRCTL for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 10:21:38

Copyright (c) 1991, 2022, Oracle.  All rights reserved.

Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER)))
STATUS of the LISTENER
------------------------
Alias                     LISTENER
Version                   TNSLSNR for Linux: Version 19.0.0.0.0 - Production
Start Date                14-AUG-2024 16:24:48
Uptime                    1 days 17 hr. 56 min. 49 sec
Trace Level               off
Security                  ON: Local OS Authentication
SNMP                      OFF
Listener Parameter File   /u01/app/grid/19.0.0/network/admin/listener.ora
Listener Log File         /u01/app/oracle/diag/tnslsnr/ora01/listener/alert/log.xml
Listening Endpoints Summary...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=LISTENER)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.21)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.93)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcps)(HOST=ora01.solutions.netapp.com)(PORT=5500))(Security=(my_wallet_directory=/u01/app/oracle2/product/19.0.0/NTAP/admin/NTAP/xdb_wallet))(Presentation=HTTP)(Session=RAW))
Services Summary...
Service "+ASM" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_DATA" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_RECO" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "+ASM_VOTE" has 1 instance(s).
  Instance "+ASM1", status READY, has 1 handler(s) for this service...
Service "1fbf0aaa1d13cb5ae06315b43d0ab734.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf142e7db2d090e06315b43d0a6894.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "1fbf203c3a46d7bae06315b43d0ae055.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAP.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "NTAPXDB.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb1.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb2.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
Service "ntap_pdb3.solutions.netapp.com" has 1 instance(s).
  Instance "NTAP1", status READY, has 1 handler(s) for this service...
The command completed successfully
[grid@ora01 ~]$

[grid@ora01 ~]$ tnsping ntap-scan

TNS Ping Utility for Linux: Version 19.0.0.0.0 - Production on 16-AUG-2024 12:07:58

Copyright (c) 1997, 2022, Oracle.  All rights reserved.

Used parameter files:
/u01/app/grid/19.0.0/network/admin/sqlnet.ora

Used EZCONNECT adapter to resolve the alias
Attempting to contact (DESCRIPTION=(CONNECT_DATA=(SERVICE_NAME=))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.90)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.91)(PORT=1521))(ADDRESS=(PROTOCOL=tcp)(HOST=10.61.180.92)(PORT=1521)))
OK (10 msec)


....
. Passez à l'utilisateur Oracle pour valider la base de données en cluster.
+
....
[oracle@ora02 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Fri Aug 16 11:32:23 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode, log_mode from v$database;

NAME      OPEN_MODE            LOG_MODE
--------- -------------------- ------------
NTAP      READ WRITE           ARCHIVELOG

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> select name from v$datafile
  2  union
  3  select name from v$controlfile
  4  union
  5  select member from v$logfile;

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/sysaux.275.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/system.274.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undo_2.277.1177083853
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/undotbs1.273.1177083797
+DATA/NTAP/1FBF0AAA1D13CB5AE06315B43D0AB734/DATAFILE/users.278.1177083901
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/sysaux.281.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/system.280.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undo_2.283.1177084061
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/undotbs1.279.1177083903
+DATA/NTAP/1FBF142E7DB2D090E06315B43D0A6894/DATAFILE/users.284.1177084103
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/sysaux.287.1177084105

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/system.286.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undo_2.289.1177084123
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/undotbs1.285.1177084105
+DATA/NTAP/1FBF203C3A46D7BAE06315B43D0AE055/DATAFILE/users.290.1177084125
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/sysaux.266.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/system.265.1177081837
+DATA/NTAP/86B637B62FE07A65E053F706E80A27CA/DATAFILE/undotbs1.267.1177081837
+DATA/NTAP/CONTROLFILE/current.261.1177080403
+DATA/NTAP/DATAFILE/sysaux.258.1177080245
+DATA/NTAP/DATAFILE/system.257.1177080129
+DATA/NTAP/DATAFILE/undotbs1.259.1177080311

NAME
--------------------------------------------------------------------------------
+DATA/NTAP/DATAFILE/undotbs2.269.1177082203
+DATA/NTAP/DATAFILE/users.260.1177080311
+DATA/NTAP/ONLINELOG/group_1.262.1177080427
+DATA/NTAP/ONLINELOG/group_2.263.1177080427
+DATA/NTAP/ONLINELOG/group_3.270.1177083297
+DATA/NTAP/ONLINELOG/group_4.271.1177083313
+RECO/NTAP/CONTROLFILE/current.256.1177080403
+RECO/NTAP/ONLINELOG/group_1.257.1177080427
+RECO/NTAP/ONLINELOG/group_2.258.1177080427
+RECO/NTAP/ONLINELOG/group_3.259.1177083313
+RECO/NTAP/ONLINELOG/group_4.260.1177083315

33 rows selected.


....
. Ou connectez-vous à EM Express pour valider la base de données RAC après l'exécution réussie du playbook.
+
image:vcf-orarac-vvol-em-001.png["Capture d'écran montrant la configuration d'Oracle EM Express."] image:vcf-orarac-vvol-em-002.png["Capture d'écran montrant la configuration d'Oracle EM Express."]



====


=== Sauvegarde et récupération de la base de données Oracle RAC dans VCF avec SnapCenter



==== Configuration de SnapCenter

[%collapsible%open]
====
La version 6 de SnapCenter présente de nombreuses améliorations de fonctionnalités par rapport à la version 5, notamment la prise en charge du magasin de données VMware vVols .  SnapCenter s'appuie sur un plug-in côté hôte sur une machine virtuelle de base de données pour effectuer des activités de gestion de la protection des données prenant en compte les applications.  Pour des informations détaillées sur le plug-in NetApp SnapCenter pour Oracle, reportez-vous à cette documentationlink:https://docs.netapp.com/us-en/snapcenter/protect-sco/concept_what_you_can_do_with_the_snapcenter_plug_in_for_oracle_database.html["Que pouvez-vous faire avec le plug-in pour la base de données Oracle"^] .  Ce qui suit fournit des étapes de haut niveau pour configurer SnapCenter version 6 pour la sauvegarde et la récupération de la base de données Oracle RAC dans VCF.

. Téléchargez la version 6 du SnapCenter software depuis le site de support NetApp :link:https://mysupport.netapp.com/site/downloads["Téléchargements du support NetApp"^] .
. Connectez-vous à la machine virtuelle Windows hébergeant SnapCenter en tant qu'administrateur.  Installez les prérequis pour SnapCenter 6.0.
+
image:vcf-ora-vvol-snapctr-prerequisites.png["Capture d'écran montrant les prérequis de SnapCenter 6.0."]

. En tant qu'administrateur, installez le dernier JDK Java à partir delink:https://www.java.com/en/["Obtenez Java pour les applications de bureau"^] .
+

NOTE: Si le serveur Windows est déployé dans un environnement de domaine, ajoutez un utilisateur de domaine au groupe d'administrateurs locaux du serveur SnapCenter et exécutez l'installation de SnapCenter avec l'utilisateur de domaine.

. Connectez-vous à l'interface utilisateur de SnapCenter via le port HTTPS 8846 en tant qu'utilisateur d'installation pour configurer SnapCenter pour Oracle.
+
image:vcf-ora-vvol-snapctr-deploy-001.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Revoir `Get Started` menu pour vous mettre à jour sur SnapCenter si vous êtes un nouvel utilisateur.
+
image:vcf-ora-vvol-snapctr-deploy-002.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Mise à jour `Hypervisor Settings` dans un contexte mondial.
+
image:aws-ora-fsx-vmc-snapctr-001.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Ajouter un cluster de stockage ONTAP à `Storage Systems` avec IP de gestion de cluster et authentifié via l'ID utilisateur administrateur de cluster.
+
image:vcf-ora-vvol-snapctr-deploy-006.png["Capture d'écran montrant la configuration de SnapCenter ."] image:vcf-ora-vvol-snapctr-deploy-007.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Ajouter des machines virtuelles de base de données Oracle RAC et des machines virtuelles de plug-in vSphere `Credential` pour l'accès SnapCenter à la VM DB et à la VM du plug-in vSphere.  Les informations d'identification doivent avoir le privilège sudo sur les machines virtuelles Linux.  Vous pouvez créer différentes informations d'identification pour différents ID utilisateur de gestion pour les machines virtuelles. L'ID utilisateur de gestion de la machine virtuelle du plug-in vShpere est défini lorsque la machine virtuelle du plug-in est déployée dans vCenter.
+
image:aws-ora-fsx-vmc-snapctr-003.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Ajouter une machine virtuelle de base de données Oracle RAC dans VCF à `Hosts` avec les informations d'identification DB VM créées à l'étape précédente.
+
image:vcf-orarac-vvol-snapctr-setup-001.png["Capture d'écran montrant la configuration de SnapCenter ."] image:vcf-orarac-vvol-snapctr-setup-002.png["Capture d'écran montrant la configuration de SnapCenter ."] image:vcf-orarac-vvol-snapctr-setup-003.png["Capture d'écran montrant la configuration de SnapCenter ."]

. De même, ajoutez le plugin NetApp VMware VM à `Hosts` avec les informations d'identification de la machine virtuelle du plugin vSphere créées à l'étape précédente.
+
image:vcf-ora-vvol-snapctr-deploy-011.png["Capture d'écran montrant la configuration de SnapCenter ."] image:vcf-orarac-vvol-snapctr-setup-004.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Enfin, une fois la base de données Oracle découverte sur la machine virtuelle DB, revenons à `Settings`-`Policies` pour créer des politiques de sauvegarde de base de données Oracle.  Idéalement, créez une politique de sauvegarde du journal d’archive distincte pour permettre un intervalle de sauvegarde plus fréquent afin de minimiser la perte de données en cas de panne.
+
image:aws-ora-fsx-vmc-snapctr-002.png["Capture d'écran montrant la configuration de SnapCenter ."]




NOTE: Assurez-vous que le nom du serveur SnapCenter peut être résolu en adresse IP à partir de la machine virtuelle DB et de la machine virtuelle du plug-in vSphere.  De même, le nom de la machine virtuelle DB et le nom de la machine virtuelle du plug-in vSphere peuvent être résolus en adresse IP à partir du serveur SnapCenter .

====


==== Sauvegarde de la base de données

[%collapsible%open]
====
SnapCenter exploite l'instantané de volume ONTAP pour une sauvegarde, une restauration ou un clonage de base de données beaucoup plus rapide par rapport à la méthodologie traditionnelle basée sur RMAN.  Les instantanés sont cohérents avec l'application car la base de données est placée en mode de sauvegarde Oracle avant un instantané.

. De la `Resources` onglet, toutes les bases de données sur la machine virtuelle sont automatiquement découvertes après l'ajout de la machine virtuelle à SnapCenter.  Initialement, l'état de la base de données s'affiche comme suit `Not protected` .
+
image:vcf-orarac-vvol-snapctr-bkup-001.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Cliquez sur la base de données pour démarrer un flux de travail afin d'activer la protection de la base de données.
+
image:vcf-orarac-vvol-snapctr-bkup-002.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Appliquer la politique de sauvegarde, configurer la planification si nécessaire.
+
image:vcf-orarac-vvol-snapctr-bkup-003.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Configurez la notification de tâche de sauvegarde si nécessaire.
+
image:vcf-orarac-vvol-snapctr-bkup-005.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Consultez le résumé et terminez pour activer la protection de la base de données.
+
image:vcf-orarac-vvol-snapctr-bkup-006.png["Capture d'écran montrant la configuration de SnapCenter ."]

. La tâche de sauvegarde à la demande peut être déclenchée en cliquant sur `Back up Now` .
+
image:vcf-orarac-vvol-snapctr-bkup-007.png["Capture d'écran montrant la configuration de SnapCenter ."] image:vcf-orarac-vvol-snapctr-bkup-008.png["Capture d'écran montrant la configuration de SnapCenter ."]

. La tâche de sauvegarde peut être surveillée à l' `Monitor` onglet en cliquant sur la tâche en cours d'exécution.
+
image:vcf-orarac-vvol-snapctr-bkup-009.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Cliquez sur la base de données pour consulter les ensembles de sauvegarde terminés pour la base de données RAC.
+
image:vcf-ora-vvol-snapctr-bkup-010.png["Capture d'écran montrant la configuration de SnapCenter ."]



====


==== Restauration/récupération de base de données

[%collapsible%open]
====
SnapCenter fournit un certain nombre d'options de restauration et de récupération pour la base de données Oracle RAC à partir d'une sauvegarde instantanée.  Dans cet exemple, nous démontrons comment restaurer à partir d'une ancienne sauvegarde instantanée, puis transférer la base de données vers le dernier journal disponible.

. Tout d’abord, exécutez une sauvegarde instantanée.  Ensuite, créez une table de test et insérez une ligne dans la table pour valider la base de données récupérée à partir de l'image instantanée avant que la création de la table de test ne récupère la table de test.
+
....
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 10:31:12 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> show pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.


SQL> create table test (id integer, dt timestamp, event varchar(100));

Table created.

SQL> insert into test values (1, sysdate, 'validate SnapCenter rac database restore on VMware vVols storage');

1 row created.

SQL> commit;

Commit complete.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage


SQL>

....
. Depuis SnapCenter `Resources` onglet, ouvrez la page de topologie de sauvegarde de la base de données NTAP1.  Mettez en surbrillance l’ensemble de sauvegarde des données instantanées créé il y a 3 jours.  Cliquez sur `Restore` pour lancer le flux de travail de restauration-récupération.
+
image:vcf-orarac-vvol-snapctr-restore-001.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Choisissez l'étendue de la restauration.
+
image:vcf-orarac-vvol-snapctr-restore-002.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Choisissez l'étendue de la récupération à `All Logs` .
+
image:vcf-orarac-vvol-snapctr-restore-003.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Spécifiez tous les pré-scripts facultatifs à exécuter.
+
image:vcf-orarac-vvol-snapctr-restore-004.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Spécifiez tout script ultérieur facultatif à exécuter.
+
image:vcf-orarac-vvol-snapctr-restore-005.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Envoyez un rapport de travail si vous le souhaitez.
+
image:vcf-orarac-vvol-snapctr-restore-006.png["Capture d'écran montrant la configuration de SnapCenter ."]

. Consultez le résumé et cliquez sur `Finish` pour lancer la restauration et la récupération.
+
image:vcf-orarac-vvol-snapctr-restore-007.png["Capture d'écran montrant la configuration de SnapCenter ."]

. À partir de la machine virtuelle RAC DB ora01, validez qu'une restauration/récupération réussie de la base de données a été effectuée vers son état le plus récent et a récupéré la table de test créée 3 jours plus tard.
+
....

[root@ora01 ~]# su - oracle
[oracle@ora01 ~]$ sqlplus / as sysdba

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Aug 19 11:51:15 2024
Version 19.18.0.0.0

Copyright (c) 1982, 2022, Oracle.  All rights reserved.


Connected to:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

SQL> select name, open_mode from v$database;

NAME      OPEN_MODE
--------- --------------------
NTAP      READ WRITE

SQL> sho pdbs

    CON_ID CON_NAME                       OPEN MODE  RESTRICTED
---------- ------------------------------ ---------- ----------
         2 PDB$SEED                       READ ONLY  NO
         3 NTAP_PDB1                      READ WRITE NO
         4 NTAP_PDB2                      READ WRITE NO
         5 NTAP_PDB3                      READ WRITE NO
SQL> alter session set container=ntap_pdb1;

Session altered.

SQL> select * from test;

        ID
----------
DT
---------------------------------------------------------------------------
EVENT
--------------------------------------------------------------------------------
         1
19-AUG-24 10.36.04.000000 AM
validate SnapCenter rac database restore on VMware vVols storage

SQL> select current_timestamp from dual;

CURRENT_TIMESTAMP
---------------------------------------------------------------------------
19-AUG-24 11.55.20.079686 AM -04:00



SQL> exit
Disconnected from Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.18.0.0.0

....


Ceci termine la démonstration de la sauvegarde, de la restauration et de la récupération SnapCenter de la base de données Oracle RAC dans VCF avec vVols.

====


== Où trouver des informations supplémentaires

Pour en savoir plus sur les informations décrites dans ce document, consultez les documents et/ou sites Web suivants :

* link:https://www.vmware.com/products/cloud-infrastructure/vmware-cloud-foundation["Fondation VMware Cloud"^]
* link:https://docs.netapp.com/us-en/snapcenter/["Documentation du SnapCenter software"^]
* link:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/index.html["Documentation des ONTAP tools for VMware vSphere"^]

