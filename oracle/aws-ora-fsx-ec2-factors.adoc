---
sidebar: sidebar 
permalink: oracle/aws-ora-fsx-ec2-factors.html 
summary: 'Cette section fournit des détails sur les facteurs à prendre en compte lors du déploiement d"une base de données Oracle sur une instance AWS EC2 et un stockage FSx.' 
keywords: HA, DR, database, Oracle, RDS, AWS, SnapCenter 
---
= Facteurs à prendre en compte pour le déploiement de la base de données Oracle
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Un cloud public offre de nombreux choix en matière de calcul et de stockage, et l'utilisation du type approprié d'instance de calcul et de moteur de stockage est un bon point de départ pour le déploiement de la base de données.  Vous devez également sélectionner des configurations de calcul et de stockage optimisées pour les bases de données Oracle.

Les sections suivantes décrivent les principales considérations à prendre en compte lors du déploiement d'une base de données Oracle dans un cloud public AWS sur une instance EC2 avec stockage FSx.



== Performances de la machine virtuelle

La sélection de la bonne taille de machine virtuelle est importante pour des performances optimales d’une base de données relationnelle dans un cloud public.  Pour de meilleures performances, NetApp recommande d'utiliser une instance EC2 M5 Series pour le déploiement Oracle, optimisée pour les charges de travail de base de données.  Le même type d’instance est également utilisé pour alimenter une instance RDS pour Oracle par AWS.

* Choisissez la bonne combinaison vCPU et RAM en fonction des caractéristiques de la charge de travail.
* Ajoutez de l’espace d’échange à une machine virtuelle.  Le déploiement d’instance EC2 par défaut ne crée pas d’espace d’échange, ce qui n’est pas optimal pour une base de données.




== Disposition et paramètres de stockage

NetApp recommande la disposition de stockage suivante :

* Pour le stockage NFS, la disposition de volume recommandée est de trois volumes : un pour le binaire Oracle ; un pour les données Oracle et un fichier de contrôle en double ; et un pour le journal actif Oracle, le journal archivé et le fichier de contrôle.
+
image:aws-ora-fsx-ec2-stor-012.png["Figure montrant une boîte de dialogue d'entrée/sortie ou représentant un contenu écrit"]

* Pour le stockage iSCSI, la disposition de volume recommandée est de trois volumes : un pour le binaire Oracle ; un pour les données Oracle et un fichier de contrôle en double ; et un pour le journal actif Oracle, le journal archivé et le fichier de contrôle.  Cependant, chaque volume de données et de journaux devrait idéalement contenir quatre LUN.  Les LUN sont idéalement équilibrés sur les nœuds du cluster HA.
+
image:aws-ora-fsx-ec2-stor-013.png["Figure montrant une boîte de dialogue d'entrée/sortie ou représentant un contenu écrit"]

* Pour les IOPS et le débit de stockage, vous pouvez choisir le seuil pour les IOPS et le débit provisionnés pour le cluster de stockage FSx, et ces paramètres peuvent être ajustés à la volée à chaque fois que la charge de travail change.
+
** Le paramètre IOPS automatique est de trois IOPS par Gio de capacité de stockage allouée ou de stockage défini par l'utilisateur jusqu'à 80 000.
** Le niveau de débit est incrémenté comme suit : 128, 256, 512, 1 024, 2 045 Mbps.




Passez en revue lelink:https://docs.aws.amazon.com/fsx/latest/ONTAPGuide/performance.html["Performances Amazon FSx ONTAP"^] documentation lors du dimensionnement du débit et des IOPS.



== Configuration NFS

Linux, le système d’exploitation le plus courant, inclut des fonctionnalités NFS natives.  Oracle propose le client NFS direct (dNFS) intégré nativement à Oracle.  Oracle prend en charge NFSv3 depuis plus de 20 ans. dNFS est pris en charge avec NFSv3 avec toutes les versions d'Oracle.  NFSv4 est pris en charge par tous les systèmes d'exploitation qui suivent la norme NFSv4. La prise en charge dNFS pour NFSv4 nécessite Oracle 12.1.0.2 ou supérieur.  NFSv4.1 nécessite une prise en charge spécifique du système d'exploitation.  Consultez l'outil NetApp Interoperability Matrix (IMT) pour connaître les systèmes d'exploitation pris en charge. La prise en charge dNFS pour NFSv4.1 nécessite la version Oracle 19.3.0.0 ou supérieure.

Le déploiement Oracle automatisé à l’aide de la boîte à outils d’automatisation NetApp configure automatiquement dNFS sur NFSv3.

Autres facteurs à prendre en compte :

* Les tables d'emplacements TCP sont l'équivalent NFS de la profondeur de file d'attente de l'adaptateur de bus hôte (HBA).  Ces tables contrôlent le nombre d’opérations NFS qui peuvent être en attente à tout moment.  La valeur par défaut est généralement 16, ce qui est bien trop faible pour des performances optimales.  Le problème inverse se produit sur les noyaux Linux plus récents, qui peuvent augmenter automatiquement la limite de la table des emplacements TCP à un niveau qui sature le serveur NFS avec des requêtes.
+
Pour des performances optimales et pour éviter les problèmes de performances, ajustez les paramètres du noyau qui contrôlent les tables d'emplacements TCP sur 128.

+
[source, cli]
----
sysctl -a | grep tcp.*.slot_table
----
* Le tableau suivant fournit les options de montage NFS recommandées pour Linux NFSv3 - instance unique.
+
image:aws-ora-fsx-ec2-nfs-001.png["Figure montrant une boîte de dialogue d'entrée/sortie ou représentant un contenu écrit"]




NOTE: Avant d'utiliser dNFS, vérifiez que les correctifs décrits dans Oracle Doc 1495104.1 sont installés.  La matrice de support NetApp pour NFSv3 et NFSv4 n'inclut pas de systèmes d'exploitation spécifiques.  Tous les systèmes d’exploitation qui respectent la RFC sont pris en charge.  Lorsque vous recherchez la prise en charge NFSv3 ou NFSv4 dans IMT en ligne, ne sélectionnez pas un système d'exploitation spécifique, car aucune correspondance ne sera affichée.  Tous les systèmes d’exploitation sont implicitement pris en charge par la politique générale.



== Haute disponibilité

Comme indiqué dans l’architecture de la solution, HA est basé sur la réplication au niveau du stockage.  Par conséquent, le démarrage et la disponibilité d’Oracle dépendent de la rapidité avec laquelle les capacités de calcul et de stockage peuvent être mises en service et récupérées.  Voir les facteurs clés suivants :

* Ayez une instance de calcul de secours prête et synchronisée avec l'instance principale via la mise à jour parallèle Ansible sur les deux hôtes.
* Répliquez le volume binaire du volume principal à des fins de secours afin de ne pas avoir à installer Oracle à la dernière minute et à déterminer ce qui doit être installé et corrigé.
* La fréquence de réplication détermine la vitesse à laquelle la base de données Oracle peut être récupérée pour rendre le service disponible.  Il existe un compromis entre la fréquence de réplication et la consommation de stockage.
* Tirez parti de l’automatisation pour effectuer la récupération et le passage en mode veille rapidement et sans erreur humaine.  NetApp fournit une boîte à outils d’automatisation à cet effet.

